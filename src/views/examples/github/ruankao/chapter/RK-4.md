# 操作系统知识

## 1、操作系统

- 管理系统的硬件、软件、数据资源
- 控制程序运行
- 人机之间的接口
- 应用软件与硬件之间的接口

管理：

- 进程管理
  
  - 进程的状态
  - 前趋图
  - PV操作
  - 死锁问题
- 存储管理
  
  - 段页式存储
  - 页面置换算法
- 文件管理

  - 索引文件
  - 位示图
- 作业管理
- 设备管理
- 微内核操作系统

  - 虚设备与SPOOLING技术

## 2、进程管理 - 进程的状态

3态模型：

`等待状态` > `就绪状态` > `运行状态`

当 "任务A" 运行一个时间段没有执行完毕时、将会调度到就绪状态、等待下一个时间段再次进入运行状态

5态模型：

`活跃阻塞` > `活跃就绪` > `运行状态`

`静止阻塞` > `静止就绪` > `运行状态`

当`静止态`被挂起时、将执行下个任务。等待恢复成`活跃态`时继续执行

## 3、进程管理 - 前趋图

先后的约束关系

## 4、进程管理 - 进程的同步与互斥

互斥：同一时间内只能执行一个任务

同步：同一时间内执行多个任务、`提前完成的任务`需要等待`没有完成的任务`。


## 5、 PV 操作

临界资源：诸进程间需要互斥方式对其进行共享的资源；如打印机等

临界区：每个进程中的访问临界资源的代码段

信号量(S)：一种特殊的变量

P操作：S = S - 1；
```
S < 0 ? 进入进程队列 : 继续执行
```

V操作：S = S + 1；
```
S <= 0 ? 唤醒进程队列中的P操作 : 继续执行
```

> 代入实际应用场景，会更容易理解PV操作

## 6、死锁问题

进程管理是操作系统的核心、但如果设计不当、就会出现死锁的问题、如果一个进程在等待一件不可能发生的事、则进程就死锁了。而如果一个或多个进程产生死锁，就会造成系统死锁

系统至少有多少个资源不会发生死锁问题？

S = N * K - N

> S = 系统至少有多少个资源<br>
> N = 进程数量<br>
> K = 每个进程需要的系统资源数量

<br>

死锁的预防：

打破死锁的条件：互斥、保存和等待、不剥夺、环路等待

死锁的避免：

- 有序资源分配法
- 银行家算法

  - 当一个进程对资源的最大需求量不超过系统中的资源数时就可以接纳该进程
  - 进程可以分期请求资源，但请求的总数不能超过最大需求量
  - 当系统现有的资源不能满足进程尚需资源数时，对进程的请求可以推迟分配。但总能使进程在有限的时间里得到资源

  > 1、首先求出剩下资源数<br>
  > 2、**剩下资源数 > 进程需要资源数时**；该进程就可以执行完毕<br>
  > 3、**进程执行完毕后释放当前资源数 + 剩下资源数 = 最新的剩下资源数**(已经分配过的资源数、也在其中)<br>
  > 4、重复 步骤2逻辑。合理分配系统资源数


## 7、存储管理

- 分区存储组织
  - 首次适应法：依次执行、找到第一个空白区
  - 最佳适应法：依次对比、找到最接近的空白区
  - 最差适应法：依次对比、找到最大的空白区
  - 循环首次适应法：依次循环、使用上次作业后的第一个空白区并开启循环、依次使用循环的下一个空白区

- 页式存储组织

  - 优点：利用率高、碎片小、分配及管理简单
  - 缺点：增加了系统开销，可能产生抖动现象

  <br>

  > 逻辑地址(高级程序语言)：页号 + 页内地址<br>
  > 物理地址(内存)：块号(页帧号) + 页内地址<br>
  > 根据 页号按表查询块号<br>
  > 淘汰页：只能淘汰在内存中的页面 + 没有访问位的页面<br>
  > 页内地址大小一致

- 段式存储组织

  - 优点：多道程序共享内存、各段程序修改互不影响
  - 缺点：内存利用率低、内存碎片浪费大

  <br>

  > 段表：段号 + 段长 + 基址<br>
  > 段内地址大小可以不一致

- 段页式存储组织

  - 优点：空间浪费小、存储共享容易、存储保护容易、能动态连接
  - 缺点：复杂度、开销和占用内容增加，执行速度下降
    
  <br>

  > 段表 + 页表

- 快表

  - 快表是一块小容量的相联存储器，由高速缓存器组成，速度快，并且可以从硬件上保证按内容并行查找，一般用来存放当前访问最频繁的少数活动页面的页号


## 8、存储管理 - 页面置换算法

- 最优(Optimal,OPT)算法
- 随机(RAND)算法
- 先进先出(FIFO)算法
  > 可能会产生抖动

- 最近最少使用(LRU)算法
  > 不会抖动

> 如系统中没有使用快表，则每次需要两次访问内存 * 页面数量 = 指令访问内存次数<br>
> 如使用快表，则每次只需要一次访问内存 * 页面数量 = 指令访问内存次数<br>
> 指令只会产生一次缺页中断，而操作数会产生两次缺页中断

## 9、文件管理 - 索引文件结构

默认索引结点地址项为13(0 - 12)位

默认物理盘块大小为 4B

- 0-9：物理盘块为直接索引
  > 物理盘块大小 * 10 = 索引(0 - 9)的容量大小

- 10：1024个物理盘块为一级间接索引
  > 物理盘块大小 * 1024 = 索引(10)的容量

- 11：1024个物理盘块中在存放1024个物理盘块为二级间接索引
  > 物理盘块大小 * 1024 * 1024 = 索引(11)的容量

- 12：在索引11级别中在放置1024个物理盘块，被称为三级间接索引
  > 物理盘块大小 * (1024 * 3) = 索引(12)的容量

> 间接的级别越高、访问效率越低


## 10、文件管理 - 空闲存储空间的管理

- 空闲区表法
- 空间链表法
- 位示图法
- 成组链接法

## 11、操作系统 - 文件和树型目录结构

盘符 = /

- 绝对路径：是从盘符开始的路径
  > /docs/ruankao/chapter/RK-4.md

- 相对路径：是从当前路径开始的路径
  > chapter/RK-4.md

文件属性：

  - R只读文件属性
  - A存档属性
  - S系统文件
  - H隐藏文件

文件名的组成：

  - 驱动器号
  - 路径
  - 主文件名
  - 扩展名

## 12、设备管理 - 数据传输控制方式

1. 程序控制方式
2. 程序中断方式
3. DMA方式
4. 通道
5. 输入输出处理机

## 13、设备管理 - 虚设备与SPOOLING技术

SPOOLING技术：在磁盘增加缓冲区机制

## 14、微内核操作系统

微内核：
- 优点：系统的可靠性、稳定性和安全性高
- 缺点：用户态和核心态需要频繁切换，导致系统效率低
